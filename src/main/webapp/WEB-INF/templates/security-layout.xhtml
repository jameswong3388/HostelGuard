<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title><ui:insert name="title">Default Title</ui:insert></title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PrimeFaces Icons -->
    <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces"/>
    <ui:insert name="head"/>
</h:head>

<h:body class="bg-gray-50 text-gray-800">
    <!-- Top Nav -->
    <header class="flex items-center justify-between px-12 py-4 bg-white border-b">
        <!-- Left: Brand/Title -->
        <h:link outcome="/security/onboard-visitors.xhtml" styleClass="text-xl font-semibold hover:text-blue-600">
            HostelGuardâ„¢
        </h:link>

        <!-- Right: Icons or Profile -->
        <h:form>
            <div class="flex items-center space-x-4">
                <p:button icon="pi pi-bell" styleClass="p-button-text text-gray-700"/>

                <div class="relative">
                    <p:commandButton id="profileBtn"
                                     icon="pi pi-user"
                                     styleClass="p-button-text p-button-rounded"
                                     type="button"/>

                    <p:menu id="profileMenu"
                            overlay="true"
                            trigger="profileBtn"
                            my="left top+10"
                            at="left bottom">
                        <p:menuitem value="Settings" outcome="/security/settings/general" icon="pi pi-cog"/>
                        <p:separator/>
                        <p:menuitem value="Sign Out" icon="pi pi-sign-out" action="#{signOutController.signOut}"
                                    ajax="false"/>
                    </p:menu>
                </div>
            </div>
        </h:form>
    </header>

    <!-- Messages -->
    <p:growl id="messages" showDetail="true" />

    <!-- Idle Monitor Form -->
    <h:form id="globalForm">
        <!-- Idle Monitor -->
        <p:idleMonitor
                timeout="60000"
                onidle="PF('idleDialog').show()"
                onactive="PF('idleDialog').hide()" />

        <!-- Hidden logout button for automatic logout -->
        <p:commandButton id="autoLogoutBtn"
                         style="display:none;"
                         action="#{IdleMonitorController.handleIdle}"
                         process="@this"
                         update=":globalForm" />

        <script type="text/javascript">
            var idleDialogTimer;
            var timeLeft = 0;

            function startIdleTimer() {
                timeLeft = 15; // show the dialog for 15 seconds
                updateCountdownDisplay(timeLeft);

                idleDialogTimer = setInterval(function() {
                    timeLeft--;
                    updateCountdownDisplay(timeLeft);

                    if (timeLeft &lt;= 0) {
                        clearInterval(idleDialogTimer);
                        PF('idleDialog').hide();
                        document.getElementById('globalForm:autoLogoutBtn').click();
                    }
                }, 1000);
            }

            function stopIdleTimer() {
                clearInterval(idleDialogTimer);
            }

            function updateCountdownDisplay(value) {
                var countdownEl = document.getElementById('countdown');
                if (countdownEl) {
                    countdownEl.innerHTML = value;
                }
            }
        </script>

        <!-- Idle Dialog -->
        <p:dialog
                widgetVar="idleDialog"
                header="Session Timeout Warning"
                modal="true"
                closable="false"
                resizable="false"
                appendTo="@body"
                onShow="startIdleTimer()"
                onHide="stopIdleTimer()">

            <h:panelGrid columns="1" styleClass="p-4">
                <h:outputText
                        value="You have been inactive for a while. You will be logged out unless you continue your session."
                        styleClass="text-gray-700" />
                <br />
                <h:outputText value="You will be logged out in " styleClass="text-gray-700" />
                <span id="countdown" class="text-red-600 font-bold"></span>
                <h:outputText value=" seconds." styleClass="text-gray-700" />
            </h:panelGrid>
        </p:dialog>
    </h:form>

    <!-- Secondary Tab Nav -->
    <ui:insert name="navigation">
        <nav class="flex items-center space-x-8 px-12 py-2 bg-white border-b">
            <h:link outcome="/security/settings/general.xhtml"
                    styleClass="py-2 text-blue-600 font-medium focus:outline-none">General</h:link>
            <h:link outcome="/security/settings/account.xhtml"
                    styleClass="py-2 text-gray-500 hover:text-gray-700 focus:outline-none">Accounts</h:link>
            <h:link outcome="/security/settings/authentication-security.xhtml"
                    styleClass="py-2 text-gray-500 hover:text-gray-700 focus:outline-none">Authentication &amp; Security</h:link>
        </nav>
    </ui:insert>

    <!-- Main Content Container -->
    <main class="mx-auto px-12 py-8">
        <ui:insert name="content">
            <!-- Default content -->
        </ui:insert>
    </main>
</h:body>
</html>